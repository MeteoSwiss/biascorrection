<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Quantile Mapping Using the <code>qmap</code> Package — useqmap • biascorrection</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Quantile Mapping Using the <code>qmap</code> Package — useqmap" />
<meta property="og:description" content="Computes bias correction with quantile mapping from the qmap package" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biascorrection</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/biascorrection.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/jonasbhend/biascorrection/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Quantile Mapping Using the <code>qmap</code> Package</h1>
    <small class="dont-index">Source: <a href='http://github.com/jonasbhend/biascorrection/blob/master/R/useqmap.R'><code>R/useqmap.R</code></a></small>
    <div class="hidden name"><code>useqmap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Computes bias correction with quantile mapping from the qmap package</p>
    </div>

    <pre class="usage"><span class='fu'>useqmap</span>(<span class='no'>fcst</span>, <span class='no'>obs</span>, <span class='kw'>fcst.out</span> <span class='kw'>=</span> <span class='no'>fcst</span>, <span class='kw'>nn</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>fcst</span>), <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fcst</th>
      <td><p>n x m x k array of n lead times, m forecasts, of k ensemble 
members</p></td>
    </tr>
    <tr>
      <th>obs</th>
      <td><p>n x m matrix of veryfing observations</p></td>
    </tr>
    <tr>
      <th>fcst.out</th>
      <td><p>array of forecast values to which bias correction should be 
applied (defaults to <code>fcst</code>)</p></td>
    </tr>
    <tr>
      <th>nn</th>
      <td><p>number of lead times to be included around the lead time to be 
calibrated (i.e. <code><a href='https://rdrr.io/r/base/Round.html'>ceiling((nn - 1)/2)</a></code> before and <code><a href='https://rdrr.io/r/base/Round.html'>floor((nn - 
1)/2)</a></code> after). The interval to estimate quantile corrections is held 
constant, that is, the first <code>nn</code> lead times are used to estimate the 
quantile correction for lead time one. The default is to lump all lead
times together <code>nn = nrow(fcst)</code>.</p></td>
    </tr>
    <tr>
      <th>exact</th>
      <td><p>logical, should surrounding lead-times be used for quantiles of 
forecast as well?</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to <code>fitQmap</code> and 
<code>doQmap</code> (see <code>help(fitQmap)</code> and <code>help(doQmap)</code>)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function provides a wrapper to use the quantile mapping 
  functionality from the <code>qmap</code> package. All lead times are lumped 
  together, a potential seasonal cycle (lead-time dependency of quantile 
  correction) is not explicitly taken into account. Similarly, for the bias 
  corrected forecasts, all ensemble members are lumped together.</p>  
<p>The quantile mapping is lead time dependent, parameter <code>nn</code> is used to
  select the number of lead times on either side of the lead time that is to 
  be corrected to be included in the quantile estimation. For the beginning 
  and end of the series, the lead-time interval is kept constant, so that to 
  estimate the quantile correction for the first lead time, the first 
  <code>nn</code> lead times are used. If <code>exact = FALSE</code>, the lead time 
  dependent quantiles for the forecast are directly estimated from single
  lead times without the surrounding <code>2*nn</code> lead times. Note, however,
  that unlike for <code><a href='qqmap.html'>qqmap</a></code>, this does not speed up computation.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## initialise forcast observation pairs</span>
<span class='no'>nens</span> <span class='kw'>&lt;-</span> <span class='fl'>51</span>
<span class='no'>signal</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/outer.html'>outer</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>,<span class='fl'>4</span>,<span class='kw'>length</span><span class='kw'>=</span><span class='fl'>215</span>)), <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>30</span>, <span class='kw'>sd</span><span class='kw'>=</span><span class='fl'>0.2</span>)), <span class='st'>'+'</span>)
<span class='no'>fcst</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>signal</span>)*<span class='no'>nens</span>, <span class='kw'>shape</span><span class='kw'>=</span><span class='fl'>3</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>signal</span>), <span class='no'>nens</span>)) +
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>signal</span>)
<span class='no'>obs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>signal</span>), <span class='kw'>mean</span><span class='kw'>=</span><span class='fl'>2</span>), <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>signal</span>)) +
  <span class='no'>signal</span>
<span class='no'>fcst.debias</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>biascorrection</span><span class='kw ns'>:::</span><span class='fu'>useqmap</span>(<span class='no'>fcst</span>[,<span class='fl'>1</span>:<span class='fl'>20</span>,],
  <span class='no'>obs</span>[,<span class='fl'>1</span>:<span class='fl'>20</span>], <span class='kw'>fcst.out</span><span class='kw'>=</span><span class='no'>fcst</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>,], <span class='kw'>method</span><span class='kw'>=</span><span class='st'>'RQUANT'</span>, <span class='kw'>qstep</span><span class='kw'>=</span><span class='fl'>0.05</span>, <span class='kw'>wet.day</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='no'>oprob</span> <span class='kw'>&lt;-</span> (<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='no'>obs</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>]) - <span class='fl'>1</span>/<span class='fl'>3</span>) / (<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>obs</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>]) + <span class='fl'>1</span>/<span class='fl'>3</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>obs</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='no'>oprob</span>),
  <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>fcst</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>,], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='no'>oprob</span>),
  <span class='kw'>type</span><span class='kw'>=</span><span class='st'>'l'</span>, <span class='kw'>lwd</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>xlab</span><span class='kw'>=</span><span class='st'>'Observed quantiles'</span>,
  <span class='kw'>ylab</span><span class='kw'>=</span><span class='st'>'Forecast quantiles'</span>,
  <span class='kw'>main</span><span class='kw'>=</span><span class='st'>'Out-of-sample validation for qqmap'</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>1</span>), <span class='kw'>lwd</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>obs</span>[,<span class='fl'>21</span>:<span class='fl'>30</span>], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='no'>oprob</span>),
  <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>fcst.debias</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='no'>oprob</span>), <span class='kw'>lwd</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='input'><span class='no'>minprob</span> <span class='kw'>&lt;-</span> <span class='fl'>0.05</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span>(<span class='kw'>v</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>obs</span>[,<span class='fl'>1</span>:<span class='fl'>20</span>], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='kw'>prob</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>minprob</span>, <span class='fl'>1</span>-<span class='no'>minprob</span>)),
  <span class='kw'>lwd</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>3</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>obs</span>[,<span class='fl'>1</span>:<span class='fl'>20</span>], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='fl'>1</span>-<span class='no'>minprob</span>) + <span class='fl'>0.1</span>, <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(<span class='st'>'usr'</span>)[<span class='fl'>3</span>] + <span class='fl'>0.5</span>,
  <span class='st'>'Extrapolated\ncorrection'</span>, <span class='kw'>adj</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>,<span class='fl'>0</span>), <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>0.67</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span>(<span class='no'>obs</span>[,<span class='fl'>1</span>:<span class='fl'>20</span>], <span class='kw'>type</span><span class='kw'>=</span><span class='fl'>8</span>, <span class='fl'>1</span>-<span class='no'>minprob</span>) - <span class='fl'>0.1</span>, <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span>(<span class='st'>'usr'</span>)[<span class='fl'>3</span>] + <span class='fl'>0.5</span>,
  <span class='st'>'Explicit quantile\ncorrection'</span>, <span class='kw'>adj</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>0</span>), <span class='kw'>cex</span><span class='kw'>=</span><span class='fl'>0.67</span>)</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span>(<span class='st'>'topleft'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'No bias correction'</span>, <span class='st'>'useqmap (RQUANT)'</span>),
  <span class='kw'>lwd</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>2</span>, <span class='kw'>inset</span><span class='kw'>=</span><span class='fl'>0.05</span>)</div><div class='img'><img src='useqmap-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jonas Bhend.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


